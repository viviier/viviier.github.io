<!doctype html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> Hexo </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Hexo</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/07/[译]驯服ES7的异步野兽 - async/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ant">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/07/[译]驯服ES7的异步野兽 - async/" itemprop="url">
                  ［译］驯服ES7的异步野兽 - async
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-07T01:19:46+08:00">
                2017-02-07
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>［译］驯服ES7的异步野兽 - async</p>
<blockquote>
<ul>
<li>原文链接： <a href="https://pouchdb.com/2015/03/05/taming-the-async-beast-with-es7.html" target="_blank" rel="external">Taming the asynchronous beast with ES7</a></li>
<li>作者： <a href="https://twitter.com/nolanlawson" target="_blank" rel="external">Nolan Lawson</a></li>
<li>译者： <a href="http://www.viviier.com" target="_blank" rel="external">ant</a></li>
</ul>
</blockquote>
<p>在PouchDB里面最棘手的一个问题是它的异步API。我在Stack Overflow，Github和IRC上看见过很多关于此类的问题和困惑，并且关于callbacks和promises几乎也有很多人经常误解。</p>
<p>PouchDB是对IndexedDB，WebSQL，LevelDB和CouchDB的一个抽象化过程。PouchDB所有的API都是异步的，因此PouchDB也必须是异步的。</p>
<p>有时我们想要去优雅的使用database的API，然而在真正使用的时候我们仍然会受到‘从简’的思维影响去使用相对简单的LocalStorage：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(!localStorage.foo) &#123;</div><div class="line">    localStorage.foo = <span class="string">'bar'</span>;</div><div class="line">&#125;;</div><div class="line"><span class="built_in">console</span>.log(localStorage.foo);</div></pre></td></tr></table></figure>
<p>使用LocalStorage时，你只需要简单的将它视为碰巧可以保存你的数据的一个神奇的JavaScript对象，它使用同步的方法来处理JavaScript本身。而对于LocalStorage存在的一些问题，它人性化的API说明也使得它能够继续流行下去。人们继续使用LocalStorage，是因为它简单并且它的工作思维在用户的预期之中（同步）。</p>
<h3 id="Promises-不是万能药"><a href="#Promises-不是万能药" class="headerlink" title="Promises 不是万能药"></a>Promises 不是万能药</h3><p>对于PouchDB，我们尝试使用异步的API promise来减轻它的复杂度，借此来帮助我们摆脱恐怖的“回调地狱”。</p>
<p>然而promise代码仍然很生硬，因为promise只是替换了原来的写法，如<code>try</code>，<code>catch</code>和<code>return</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> db = <span class="keyword">new</span> PouchDB(<span class="string">'mydb'</span>);</div><div class="line">db.porst(&#123;&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> db.get(result.id);</div><div class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">doc</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(doc);</div><div class="line">&#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(err);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>作为JavaScript开发者，我们现在的脑海中需要有一条直线，上面有着一个并行的系统 - 同步和异步。随着我们的控制流越来越多越来越复杂，这种方式就会变的比较糟糕。为此，我们需要去学习像<code>Promise.all()</code>和<code>Promise.resolve()</code>这样的API，或者我们只是在众多的javascript库中找到了一个我们能够读懂并且能够帮助我们解决这个问题的库。</p>
<p>直到最近，这都是我们最好到的解决方法，但是ES7的出现改变了这一切。</p>
<h3 id="拥抱ES7"><a href="#拥抱ES7" class="headerlink" title="拥抱ES7"></a>拥抱ES7</h3><p>当你知道了什么是ES7之后，你可以像这样重写上面的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> db = <span class="keyword">new</span> PouchDB(<span class="string">'mydb'</span>)</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">let</span> result = <span class="keyword">await</span> db.post(&#123;&#125;)</div><div class="line">    <span class="keyword">let</span> doc = <span class="keyword">await</span> db.get(result.id)</div><div class="line">    <span class="built_in">console</span>.log(doc)</div><div class="line">&#125; <span class="keyword">catch</span> (err)&#123;</div><div class="line">    <span class="built_in">console</span>.log(err)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>并且，我们能够这么舒服的去书写这种代码也要感谢像Babel.js，Regenerator这样能把ES6/7代码转换为ES5运行浏览器上的工具。</p>
<h3 id="Async-函数"><a href="#Async-函数" class="headerlink" title="Async 函数"></a>Async 函数</h3><p>ES7给了我们一个新的函数类，<code>async function</code>，在async函数内，我们有一个新的关键字，<code>await</code>，我们可以用它来等待一个promise函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">myFunction</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> result = <span class="keyword">await</span> somethingThatReturnsAPromise()</div><div class="line">    <span class="built_in">console</span>.log(result)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果promise返回状态为resolve，我们就可以立即进行下一条代码，如果返回状态为reject，那么会抛出一条错误，所以<code>try/catch</code>实际上也在工作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">myFunction</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="keyword">await</span> somethingThatReturnsAPromise()</div><div class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</div><div class="line">        <span class="built_in">console</span>.log(err)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>async让我们写出来的代码看起来像是同步，但实际上是异步的。还有一个细节是事实上这个API返回的是一个promise而没有去阻塞事件的进行。</p>
<p><img src="https://pouchdb.com/static/img/pepperidge_farm_remembers.png" alt="pic"></p>
<p>还有一个async的特性是，我们能能够使用任何能够返回promise函数的库。PouchDB就是这样的库，所以让我们去测试一下吧。</p>
<h3 id="处理错误以及返回值"><a href="#处理错误以及返回值" class="headerlink" title="处理错误以及返回值"></a>处理错误以及返回值</h3><p>首先，让我们考虑一个在PouchDB里常见的一个用法：如果_id存在的话，我们想通过<code>_id</code>来<code>get()</code>一个文件，否则我们返回一个新的文件.</p>
<p>使用promise，你应该会这样写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">db.get(<span class="string">'docid'</span>).catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(err.name === <span class="string">'not_found'</span>) &#123;</div><div class="line">        <span class="keyword">return</span> &#123;&#125;;  <span class="comment">// new doc</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">throw</span> err;  <span class="comment">// 404</span></div><div class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">doc</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(doc);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>如果使用async函数，就可以这样来写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> doc</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    doc = <span class="keyword">await</span> db.get(<span class="string">'docid'</span>)</div><div class="line">&#125; <span class="keyword">catch</span> (err) &#123;</div><div class="line">    <span class="keyword">if</span>(err.name === <span class="string">'not_found'</span>) &#123;</div><div class="line">        doc = &#123;&#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">throw</span> err</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(doc)</div></pre></td></tr></table></figure>
<p>可读性上升！这是几乎相同的代码，<code>if db.get()</code>直到返回一个新的doc而不是一个promise。它们之间唯一的不同是我们添加了一个<code>await</code>关键字来处理我们所调用的任何的返回pormise的函数。</p>
<h3 id="潜在陷阱"><a href="#潜在陷阱" class="headerlink" title="潜在陷阱"></a>潜在陷阱</h3><p>还有一些很细微的问题，我很高兴我能在使用的过程中遇到它们。</p>
<p>首先，无论你在时候什么地方使用<code>await</code>，你都需要把它放在async函数内，所以如果你的代码严重依赖PouchDB，你可能发现你会写很多关于异步（async）的函数，而相对写的普通的函数就很少。</p>
<p>另一方面，更加需要注意的一个问题是你的代码需要小心翼翼的放在<code>try/catch</code>中，否则当promise返回reject的时候，错误不会被抛出，因此你看不到代码的问题所在。</p>
<p>我的忠告是确保你的异步代码被<code>try/catch</code>完全包围住。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">createNewDoc</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> response = <span class="keyword">await</span> db.post(&#123;&#125;)</div><div class="line">    <span class="keyword">return</span> <span class="keyword">await</span> db.get(response.id)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">printDoc</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="keyword">let</span> doc = <span class="keyword">await</span> createNewDoc()</div><div class="line">        <span class="built_in">console</span>.log(doc)</div><div class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</div><div class="line">        <span class="built_in">console</span>.log(err)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><p>当使用异步函数去处理迭代时令人印象深刻。举个例子，我们想要插入一些文档到数据库里面，但是对于执行顺序，我们想要promise函数执行一个之后再执行另外一个，而不是同时执行。</p>
<p>遵循ES6规范的promise，我们可以去链式调用我们的promise函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> promise = <span class="built_in">Promise</span>.resolve();</div><div class="line"><span class="keyword">var</span> docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;];</div><div class="line"></div><div class="line">docs.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">doc</span>) </span>&#123;</div><div class="line">    promise = promise.then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> db.post(doc)</div><div class="line">    &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">promise.then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// 现在我们所有的docs都被保存</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>这种代码不够优雅，并且也容易引发错误，因为如果你偶然的这么写了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docs.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">doc</span>) </span>&#123;</div><div class="line">    promise = promise.then(db.post(doc));</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>然后这个promise其实将会并发执行，这样会发生意想不到的结果。</p>
<p>使用ES7，虽然我们可以只使用一个简单的for循环：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">let docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;]</div><div class="line"></div><div class="line">for(let i = 0; i &lt; docs.length; i++) &#123;</div><div class="line">    let doc = docs[i]</div><div class="line">    await db.post(doc)</div><div class="line">&#125;</div><div class="line"></div><div class="line">这个非常简洁的代码和链式调用promise相同。我们甚至能够使它更简洁，通过使用&lt;code&gt;for...of&lt;/code&gt;：</div><div class="line"></div><div class="line">```javascript</div><div class="line">let docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;]</div><div class="line"></div><div class="line">for(let doc of docs) &#123;</div><div class="line">    await db.post(doc)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意这里不能使用<code>forEach()</code>循环，如果你这么写了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;]</div><div class="line"></div><div class="line"><span class="comment">// WARNING: this won't work</span></div><div class="line">docs.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">doc</span>) </span>&#123;</div><div class="line">    <span class="keyword">await</span> db.post(doc)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>然后Babel.js将会报出一个错误：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Error</span> : <span class="regexp">/../</span>script.js: Unexpected token (<span class="number">38</span>:<span class="number">23</span>)</div><div class="line">&gt; <span class="number">38</span> |     <span class="keyword">await</span> db.post(doc);</div><div class="line">     |           ^</div></pre></td></tr></table></figure>
<p>这是因为你不能使用<code>await</code>在普通函数中。你需要一个async函数。</p>
<p>然而，如果你尝试去使用async函数，那么你将会遇到一些奇怪的bug：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;]</div><div class="line"></div><div class="line"><span class="comment">// WARNING: this won't work</span></div><div class="line">docs.forEach(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">doc, i</span>) </span>&#123;</div><div class="line">    <span class="keyword">await</span> db.post(doc)</div><div class="line">    <span class="built_in">console</span>.log(i)</div><div class="line">&#125;)</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'main loop done'</span>)</div></pre></td></tr></table></figure>
<p>这段代码可以编译，但在输出的时候就会看到问题：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">main loop done</div><div class="line"><span class="number">0</span></div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">2</span></div></pre></td></tr></table></figure>
<p>发生了什么让主函数提前退出，是因为<code>await</code>其实是在子函数里，此外，它将会同时执行每一个promise，这并不是我们想要的结果。</p>
<p>所以这告诉我们，当你的异步函数中有任何的函数时一定要小心。<code>await</code>只会暂停它的父函数，所以在检查的时候要注意，它在做的，以及实际上你要他做的，是不是同一件事。</p>
<h3 id="并发循环"><a href="#并发循环" class="headerlink" title="并发循环"></a>并发循环</h3><p>如果我们想要同时执行很多的promise，那么使用ES7就能简单优雅的完成。</p>
<p>回到ES6的promise，我们可以使用<code>Promise.all()</code>。使用它从promise数组里来返回一个数组值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;];</div><div class="line"></div><div class="line"><span class="keyword">return</span> <span class="built_in">Promise</span>.all(docs.map(<span class="function"><span class="keyword">function</span> (<span class="params">doc</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> db.post(doc);</div><div class="line">&#125;)).then(<span class="function"><span class="keyword">function</span> (<span class="params">results</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(results);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>在ES7，我们可以使用更直观的方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;]</div><div class="line"><span class="keyword">let</span> promises = docs.map(<span class="function">(<span class="params">doc</span>) =&gt;</span> db.post(doc))</div><div class="line"></div><div class="line"><span class="keyword">let</span> results = []</div><div class="line"><span class="keyword">for</span>(<span class="keyword">let</span> promise <span class="keyword">of</span> promises) &#123;</div><div class="line">    result.push(<span class="keyword">await</span> promise)</div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(results)</div></pre></td></tr></table></figure>
<p>这段代码重要的结构是 1) 创建<code>promises</code>数组，然后立即开始调用所有的promise函数 2)然后我们在主函数中使用<code>await</code>来处理promise。如果我们尝试了使用<code>Array.prototype.map，那么它将不会工作：</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;]</div><div class="line"><span class="keyword">let</span> promises  = docs.map(<span class="function">(<span class="params">doc</span>) =&gt;</span> db.post(doc))</div><div class="line"></div><div class="line"><span class="comment">// WARNING: this doesn't work</span></div><div class="line"><span class="keyword">let</span> results = promises.map(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params">promise</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">await</span> promise</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// This will just be a list of promise :(</span></div><div class="line"><span class="built_in">console</span>.log(results)</div></pre></td></tr></table></figure>
<p>这段代码不会工作的原因是我们使用<code>await</code>时把它放在了子函数内，而不是主函数，所以主函数退出之前我们就完成了waiting。</p>
<p>如果你不介意使用<code>Promise.all</code>，你也可以使用它来整理你的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;]</div><div class="line"><span class="keyword">let</span> promises = docs.map(<span class="function">(<span class="params">doc</span>) =&gt;</span> db.post(doc))</div><div class="line"></div><div class="line"><span class="keyword">let</span> results = <span class="keyword">await</span> <span class="built_in">Promise</span>.all(promises)</div><div class="line"><span class="built_in">console</span>.log(results)</div></pre></td></tr></table></figure>
<p>如果我们能够使用数组推导（array comprehesions）想必看起来可以更好。然而，现在它还不算太规范，所以目前还不被Regenerator支持。</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>ES7仍然很流行。但Node.js和io.js还不支持Async函数，你需要去加载一些实验性的插件才能让Babel编译它。就目前来说，async/await规范仍然处于“提案”状态。</p>
<p>对此，你需要一些ES6的代码转换工具包括Regenerator和ES6的编译工具使得代码能够工作在ES5的浏览器上。对于我来说，这些工具加起来差不多60KB，代码压缩和gzipped。然而对于大多数开发者来说，这些工具太多，水很深。</p>
<p>但是这些新的工具使用起来非常有趣，使用它们时工作就像是用颜料涂满画卷，而且关于异步的库也让我仿佛看到了ES7美好的未来。</p>
<p>所以，如果你也想玩一下，你可以点击进入我写的一个小的<a href="https://github.com/nolanlawson/async-functions-in-pouchdb" target="_blank" rel="external">demo库</a>。开始运行它，只需要解压代码，然后运行<code>npm install &amp;&amp; npm run build</code>。你也可以去了解更多关于ES7的内容，或是去观看Jafar Husain在youtube上的<a href="https://www.youtube.com/watch?v=DqMFX91ToLw" target="_blank" rel="external">演讲</a>。</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>异步函数在ES7里是一个新的概念，它们让之前不在异步中使用的<code>return</code>和<code>try/catch</code>回归，并且鼓励我们用同步的代码来书写异步，虽然看起来像老旧的代码，但是它拥有着更高的性能。</p>
<p>更重药的是，异步函数使得像PouchDB这样的API更容易工作。所以希望这将能改变少量用户错误和混乱的代码，并且让我们能写出更具优雅性和可读性的代码。</p>
<p>而且谁也不知道，也许人们最后将会放弃LocalStorage，并选择相对来说更现代的客户端数据库。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/21/算法 - 二分查找 斐波那契/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ant">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/21/算法 - 二分查找 斐波那契/" itemprop="url">
                  算法 - 二分查找 斐波那契
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-21T23:21:55+08:00">
                2017-01-21
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="二分查找"><a href="#二分查找" class="headerlink" title="二分查找"></a>二分查找</h3><blockquote>
<p>对有序的数据进行二分查找比顺序查找更高效。</p>
</blockquote>
<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><h5 id="简单例子"><a href="#简单例子" class="headerlink" title="简单例子"></a>简单例子</h5><p>我们有1-100个数据：<br><code>1 25 50 75 82 100</code><br>想要在其中找到数字82，进行二分查找<br><code>51 75 82 100</code><br>第一次mid”索引”为(0 + 100) / 2 = 50(Math.floor)，返回太小，因此下限变为mid + 1 = 51，上限不变<br><code>75 82 88 100</code><br>第二次mid”索引”为(51 + 100) / 2 = 75(Math.floor)，返回太小，因此下限变为mid + 1 = 76，上限不变<br><code>76 82 88 100</code><br>第三次mid”索引”为(76 + 100) / 2 = 88(Math.floor)，返回太大，因此下限不变，上限变为mid - 1 = 87<br><code>76 81 82 87</code><br>第四次mid”索引”为(76 + 87) / 2 = 81(Math.floor)，返回太小，因此下限变为mid + 1 = 82，上限不变<br><code>82 84 87</code><br>第五次mid”索引”为(82 + 87) / 2 = 84(Math.floor)，返回太大，因此下限不变，上限变为mid - 1 = 83<br><code>82 83</code><br>第六次mid”索引”为(82 + 83) / 2 = 82(Math.floor)，返回mid”索引”</p>
<p><b>二分查找的简单描述：</b><br>将数组的第一个位置设置为下边界（0）<br>将数组的最后一个元素所在的位置设置为上边界（arr.length - 1）<br>当下边界小于等于上边，进入while循环：<br>a. 将mid设置为（下边界 + 上边界）/ 2<br>b. 如果arr[mid]的元素小于查询的值，则下边界变为mid + 1<br>c. 如果arr[mid]的元素大于查询的值，则上边界变为mid - 1<br>d. 否则mid等于查询的值，返回mid<br>如果没有找到，退出循环，返回-1</p>
<h5 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line"> * @二分查找</div><div class="line"> * @arr, data 传入参数</div><div class="line"> * @lowerBound, upperBound, mid 定义数组左边取值范围，定义数组右边取值范围，相加为总范围，mid为总范围除2取中间值</div><div class="line"> * @循环判断中间值arr[i]小于 大于 等于data，做出相应的返回</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">binSearch</span>(<span class="params">arr, data</span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> lowerBound = <span class="number">0</span></div><div class="line">  <span class="keyword">let</span> upperBound = arr.length - <span class="number">1</span></div><div class="line">  </div><div class="line">  <span class="keyword">while</span>(lowerBound &lt;= upperBound) &#123;</div><div class="line">    <span class="keyword">let</span> mid = <span class="built_in">Math</span>.floor((lowerBound + upperBound) / <span class="number">2</span>)</div><div class="line">    <span class="keyword">if</span>(arr[mid] &lt; data) &#123;</div><div class="line">      lowerBound = mid + <span class="number">1</span></div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(arr[mid] &gt; data) &#123;</div><div class="line">      upperBound = mid - <span class="number">1</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">return</span> mid</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="number">-1</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们来测试一下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">45</span>,<span class="number">55</span>]</div><div class="line"><span class="built_in">console</span>.log(binSearch(arr,<span class="number">5</span>))  <span class="comment">// 4</span></div></pre></td></tr></table></figure></p>
<h4 id="计算重复次数"><a href="#计算重复次数" class="headerlink" title="计算重复次数"></a>计算重复次数</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* </span></div><div class="line"> * @arr, data</div><div class="line"> * @count, position 计数器以及是否找到元素</div><div class="line"> * @如果找到了，计数器加1，然后双重循环遍历，一个向上position + 1，一个向下position - 1，找相同元素</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">count</span>(<span class="params">arr, data</span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> count = <span class="number">0</span></div><div class="line">  <span class="keyword">let</span> position = binSearch(arr, data)</div><div class="line">  <span class="keyword">if</span>(position &gt; <span class="number">-1</span>) &#123;</div><div class="line">    ++count</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = position - <span class="number">1</span>; i &gt; <span class="number">0</span>; --i) &#123;</div><div class="line">      <span class="keyword">if</span>(arr[i] == data) &#123;</div><div class="line">        ++count</div><div class="line">      &#125;<span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = position + <span class="number">1</span>; i &lt; arr.length; ++i) &#123;</div><div class="line">      <span class="keyword">if</span>(arr[i] == data) &#123;</div><div class="line">        ++count</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">break</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> count</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们来测试一下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>]</div><div class="line"><span class="built_in">console</span>.log(count(arr, <span class="number">9</span>))  <span class="comment">// 3</span></div></pre></td></tr></table></figure></p>
<h3 id="斐波那契"><a href="#斐波那契" class="headerlink" title="斐波那契"></a>斐波那契</h3><h4 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line"> * @递归</div><div class="line"> * @a1 = 1, a2 = 2, a(n) = a(n-1) + a(n-2)   **n&gt;=3, n∈N* 通项公式</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">recurFib</span>(<span class="params">n</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span>(n &lt; <span class="number">2</span>) &#123;</div><div class="line">    <span class="keyword">return</span> n</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">return</span> recurFib(n<span class="number">-1</span>) + recurFib(n<span class="number">-2</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们来测试一下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(recurFib(<span class="number">10</span>))  <span class="comment">// 55</span></div></pre></td></tr></table></figure></p>
<h4 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h4><h5 id="动态规划解决"><a href="#动态规划解决" class="headerlink" title="动态规划解决"></a>动态规划解决</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line"> * @太多的值在递归调用中被重新计算，所以效率低下</div><div class="line"> * @用数组记载已经被纪录的值，优化效率</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dycFib</span>(<span class="params">n</span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> val = []</div><div class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i&lt;= n; i++) &#123;</div><div class="line">    val[i] = <span class="number">0</span></div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span>( n == <span class="number">1</span> || n == <span class="number">2</span>) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span></div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    val[<span class="number">1</span>] = <span class="number">1</span></div><div class="line">    val[<span class="number">2</span>] = <span class="number">2</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">3</span>; i &lt;= n; i++) &#123;</div><div class="line">      val[i] = val[i<span class="number">-1</span>] + val[i<span class="number">-2</span>]</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> val[n<span class="number">-1</span>]  <span class="comment">// 0 - 10 是11个数</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们来测试一下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(dycFib(<span class="number">10</span>))  <span class="comment">// 55</span></div></pre></td></tr></table></figure></p>
<h5 id="迭代解决"><a href="#迭代解决" class="headerlink" title="迭代解决"></a>迭代解决</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">iterFib</span>(<span class="params">n</span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> last = <span class="number">1</span></div><div class="line">  <span class="keyword">let</span> nextLast = <span class="number">1</span></div><div class="line">  <span class="keyword">let</span> result = <span class="number">1</span></div><div class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">2</span>; i &lt; n; i++) &#123;</div><div class="line">    result = last + nextLast</div><div class="line">    last = nextLast</div><div class="line">    nextLast = result</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> result</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们来测试一下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(iterFib(<span class="number">10</span>))  <span class="comment">// 55</span></div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/20/算法 - 冒泡排序 快速排序/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ant">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/20/算法 - 冒泡排序 快速排序/" itemprop="url">
                  算法 - 冒泡排序 快速排序
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-20T22:59:45+08:00">
                2017-01-20
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="模拟数组"><a href="#模拟数组" class="headerlink" title="模拟数组"></a>模拟数组</h3><h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>在学习算法之前，我们事先定义好一个测试用的数组并添加了一些常规数组操作的函数。插入数组数据，删除数组数据，显示数组数据，交换数组元素等等。</p>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">cArray</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(num) &#123;</div><div class="line">    <span class="keyword">this</span>.num = num</div><div class="line">    <span class="keyword">this</span>.pos = <span class="number">0</span></div><div class="line">    <span class="keyword">this</span>.dataStore = <span class="keyword">new</span> <span class="built_in">Array</span>(num)</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  setData() &#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.num; i++) &#123;</div><div class="line">      <span class="keyword">this</span>.dataStore[i] = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (<span class="keyword">this</span>.num + <span class="number">1</span>))</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  clear() &#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.dataStore.length; i++) &#123;</div><div class="line">      <span class="keyword">this</span>.dataStore[i] = <span class="number">0</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  insert(elm) &#123;</div><div class="line">    <span class="keyword">this</span>.dataStore[<span class="keyword">this</span>.pos++] = elm</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  swap(arr, index1, index2) &#123;</div><div class="line">    <span class="keyword">let</span> temp = arr[index1]</div><div class="line">    arr[index1] = arr[index2]</div><div class="line">    arr[index2] = temp</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  toString() &#123;</div><div class="line">    <span class="keyword">let</span> restr = <span class="string">''</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.dataStore.length; i++) &#123;</div><div class="line">      restr += <span class="keyword">this</span>.dataStore[i] + <span class="string">' '</span></div><div class="line">      <span class="keyword">if</span>( i &gt; <span class="number">0</span> &amp;&amp; i % <span class="number">10</span> === <span class="number">0</span>) &#123;</div><div class="line">        restr += <span class="string">'\n'</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> restr</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们来测试一下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> nums = <span class="number">10</span></div><div class="line"><span class="keyword">let</span> myNums = <span class="keyword">new</span> cArray(nums)</div><div class="line">myNums.setData()</div><div class="line"><span class="built_in">console</span>.log(myNums.toString())  <span class="comment">// "5 4 8 0 1 2 0 6 8 9 "</span></div></pre></td></tr></table></figure></p>
<h3 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h3><h4 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h4><p>对数组进行冒泡排序，数组会比较相邻的数据，条件判断后进行互换操作</p>
<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><h5 id="简单例子"><a href="#简单例子" class="headerlink" title="简单例子"></a>简单例子</h5><p>我们有一个列表：<br><code>B H E D A </code>  <b> ( B &gt; H ?   yes -&gt; B保持不动，继续判断H， H &gt; E ? no -&gt; H和E互换位置，继续判断H.. .)</b><br>经过第一次排序后，这个列表变成：<br><code>B E D A H</code>  <b>( 第一阶段B和H判断完后，继续用重复相同方式判断E )</b><br>经过第二次排序后，这个列表变成：<br><code>B D A E H</code><br>经过第三次排序后，这个列表变成：<br><code>B A D E H</code><br>经过第四次排序后，这个列表变成：<br><code>A B D E H</code> <b>bubble sort end&lt;</b></p>
<h5 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">bubbleSort() &#123;</div><div class="line">  </div><div class="line">  <span class="comment">/*</span></div><div class="line">   * @获取当前数组的长度</div><div class="line">   *  以及定义一个temp作为储存器</div><div class="line">   */</div><div class="line">  <span class="keyword">let</span> numsElm = <span class="keyword">this</span>.dataStore.length</div><div class="line">  <span class="keyword">let</span> temp</div><div class="line">  </div><div class="line">  <span class="comment">/*</span></div><div class="line">   * @第一个循环，获取数组的总长度，每遍历一次，数组长度减一，直到数组长度小于2</div><div class="line">   * @第二个循环，获取当前需要遍历的数组长度，从零开始全部遍历，这里的inner当做是数组的索引，如果判断失败，那么继续下一个inner的判断</div><div class="line">   * @判断，当前第inner个元素的值是否大于inner + 1 的值，如果是就交换(否则就进行 下一个索引的判断)</div><div class="line">   * @就想把里面的每一个数都跟数组里的每一个数做一个比较，如果当前判断失败，那么进行下一个，第一个数比较完成后，将数组长度－1也就是最后一个数值固定，然后继续遍历比较</div><div class="line">   */</div><div class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> outer = numsElm; outer &gt;= <span class="number">2</span>; outer--) &#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> inner = <span class="number">0</span>; inner &lt; outer - <span class="number">1</span>; inner++) &#123;</div><div class="line">      <span class="keyword">if</span>( <span class="keyword">this</span>.dataStore[inner] &gt; <span class="keyword">this</span>.dataStore[inner + <span class="number">1</span>]) &#123;</div><div class="line">        <span class="keyword">this</span>.swap(<span class="keyword">this</span>.dataStore, inner, inner + <span class="number">1</span>)</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们来测试一下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> nums = <span class="number">10</span></div><div class="line"><span class="keyword">let</span> myNums = <span class="keyword">new</span> cArray(nums)</div><div class="line">myNums.setData()</div><div class="line"><span class="built_in">console</span>.log(myNums.toString())  <span class="comment">// "9 10 10 3 4 3 6 6 2 1 "</span></div><div class="line">myNums.bubbleSort()</div><div class="line"><span class="built_in">console</span>.log(myNums.toString())  <span class="comment">// "1 2 3 3 4 6 6 9 10 10 "</span></div></pre></td></tr></table></figure></p>
<h3 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h3><h4 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h4><p>对数组进行快速排序，设置一个基准后，数组排序会围绕基准进行，将列表中所有小于基准值的元素放在基准值前面，所有相等或大于基准值的元素放在基准值的后面，然后对两个自序列重复进行上面步骤，最后和基准值合并。</p>
<h4 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h4><h5 id="简单例子-1"><a href="#简单例子-1" class="headerlink" title="简单例子"></a>简单例子</h5><p>我们有一个列表：<br><code>9 4 10 3 1 1 0 10 8 3</code><br>原始数组，基准值为9<br><code>4 3 1 1 0 8 3 <b>9</b> 10 10</code><br>数组元素按小于基准值和大于基准值分组，然后再次将数组按基准值分组，左边的基准值是4，右边的基准值是10，然后合并数组。<br><code>3 1 1 0 3 <b>4</b> 8 9 <b>10</b> 10</code><br>再次分割后，又出现了按照4为基准的子序列，左边有大于1的length，以3为基准值继续分割，右边只有一个元素，因此下一次排序，右边返回空[]，而按照10为基准的子序列只有一个元素，所以返回空[]，，然后合并数组。<br><code>1 1 0 <b>3</b> 3 <i>4 8 9 10 10</i></code><br>再次分割，以3为基准值，左边length大于1，因此以1为基准值继续分割，右边length为1，因此下一次排序，返回空[]，然后合并数组。<br><code>0 <b>1</b> <i>1 3 3 4 8 9 10 10</i></code><br>再次分割，以1为基准值，左边length为1，下次排序返回空[]，右边length为1，下次排序返回空，然后合并数组。</p>
<h5 id="实现-2"><a href="#实现-2" class="headerlink" title="实现"></a>实现</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">quickSort(arr) &#123;</div><div class="line">  <span class="comment">/*</span></div><div class="line">   * @判断传递进来的数组长度是否需要分割</div><div class="line">   * @定义左边数组，定义右边数组，定义基准值为数组的第一个元素</div><div class="line">   * @i的索引从1开始，是因为第一个(0)作为了基准值，然后循环遍历</div><div class="line">   * @判断当前元素arr[i]大于或者小于基准值，小于放在left数组里，大于放在right数组里</div><div class="line">   * 判断完成后利用递归继续将分隔出来的子数组进行轮询分隔，然后通过concat合并数组，返回新数组</div><div class="line">   */</div><div class="line">  <span class="keyword">if</span>(arr.length &lt;= <span class="number">1</span>) <span class="keyword">return</span> arr</div><div class="line">  </div><div class="line">  <span class="keyword">let</span> left = []</div><div class="line">  <span class="keyword">let</span> right = []</div><div class="line">  <span class="keyword">let</span> pivot = arr[<span class="number">0</span>]</div><div class="line">  </div><div class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; arr.length; i++) &#123;</div><div class="line">    <span class="keyword">if</span>(arr[i] &lt; pivot) &#123;</div><div class="line">      left.push(arr[i])</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      right.push(arr[i])</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.quickSort(left).concat(pivot, <span class="keyword">this</span>.quickSort(right))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们来测试一下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> nums = <span class="number">10</span></div><div class="line"><span class="keyword">let</span> myNums = <span class="keyword">new</span> cArray(nums)</div><div class="line">myNums.setData()</div><div class="line"><span class="built_in">console</span>.log(myNums.toString())  <span class="comment">// "9, 5, 7, 2, 1, 1, 2, 13, 132, 68 "</span></div><div class="line"><span class="built_in">console</span>.log(myNums.quickSort(myNums.dataStore).toString())  <span class="comment">// "1, 1, 2, 2, 5, 7, 9, 13, 68, 132 "</span></div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/08/ECMAScript6 generator co async/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ant">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/08/ECMAScript6 generator co async/" itemprop="url">
                  ECMAScript6 generator co async
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-08T23:46:47+08:00">
                2017-01-08
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="关于异步"><a href="#关于异步" class="headerlink" title="关于异步"></a>关于异步</h3><p>在执行IO操作时，javascript代码无需等待，而是传入回调函数后，继续执行后续的代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$.getJSON(<span class="string">'http://example/ajax'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span>(err) <span class="keyword">throw</span> err</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'等待结果返回'</span>)</div><div class="line">&#125;)</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'不等待结果返回执行'</span>)</div></pre></td></tr></table></figure>
<p>而同步的IO操作则需要等待结果完成后才能继续执行后面的代码。在等待时间内，无法响应其他任何事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> data = getJSONSync(<span class="string">'http://example.com/ajax'</span>);</div></pre></td></tr></table></figure>
<p>通过回调函数异步读取文件的简单例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">fs.readFile(<span class="string">'nico.txt'</span>, (err, data) =&gt; &#123;</div><div class="line">  <span class="keyword">if</span>(err) <span class="keyword">throw</span> err</div><div class="line">  <span class="built_in">console</span>.log(data)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><blockquote>
<p>将回调函数的横向加载改为纵向加载，解决回调函数多层嵌套问题。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">fs.readFile(fileA, (err, data) =&gt; &#123;</div><div class="line">  fs.readFile(fileB, (err, data) =&gt; &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">  &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>如果依次读取多个文件，就会出现多重嵌套，代码就会无法管理。采用Promise，连续读取多个文件，就可以解决回调函数带来的问题。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> readFile = <span class="built_in">require</span>(<span class="string">'fs-redfile-promise'</span>)</div><div class="line"></div><div class="line">readFile(fileA)</div><div class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(data.toString()))</div><div class="line">  .then(<span class="function"><span class="params">()</span> =&gt;</span> readFile(fileB))</div><div class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(data.toString))</div><div class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err))</div></pre></td></tr></table></figure></p>
<p>Promise提供then方法加载回调函数，catch捕获错误。但是Promis只是回调函数的改进，代码含有有大量的then，语义不清晰，而且代码冗余。那么，有没有更好的解决方法呢？</p>
<h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3><h4 id="关于Generator"><a href="#关于Generator" class="headerlink" title="关于Generator"></a>关于Generator</h4><blockquote>
<p>交出函数的执行权（暂停执行）。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params">x</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> y = <span class="keyword">yield</span> x + <span class="number">2</span>;</div><div class="line">  <span class="keyword">return</span> y;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上代码就是一个Generator函数。整个generator函数就是一个封装的异步函数，异步操作需要暂停的地方，都用yield语句注明。Generator函数的执行方法如下。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> g = gen(<span class="number">1</span>);</div><div class="line">g.next();  <span class="comment">// &#123; value: 3, done: false &#125;</span></div><div class="line">g.next();  <span class="comment">// &#123; value: undefined, done: true &#125;</span></div></pre></td></tr></table></figure>
<p>执行generator函数返回的是指针对象。调用指针的next方法，会移动内部指针，指向第一个遇到的yield语句上，上例是执行到 x + 2 为止。</p>
<h4 id="generator传值与错误处理"><a href="#generator传值与错误处理" class="headerlink" title="generator传值与错误处理"></a>generator传值与错误处理</h4><p>next方法返回值的value属性，是generator函数向外输出数据。next方法还可以接受参数，向generator函数体内输入数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params">x</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> y = <span class="keyword">yield</span> x + <span class="number">2</span>;</div><div class="line">  <span class="keyword">return</span> y;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> g = gen(<span class="number">1</span>);</div><div class="line">g.next();  <span class="comment">// &#123; value: 3, done: false &#125;</span></div><div class="line">g.next(<span class="number">2</span>);  <span class="comment">// &#123; value: 2, done: true &#125;</span></div></pre></td></tr></table></figure>
<p>上面代码中，第一个next方法的value属性，返回表达式 x + 2的值。第二个next方法带有参数2，作为上个阶段异步任务的返回值，被函数体变量个y接收。因此这一步的value属性，返回的就是2。</p>
<p>Generator函数内部还可以处理错误代码，捕获函数体外抛出的错误。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params">x</span>) </span>&#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">     <span class="keyword">var</span> y = <span class="keyword">yield</span> x + <span class="number">2</span>;</div><div class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">     <span class="built_in">console</span>.log(e);</div><div class="line">  &#125;</div><div class="line">    <span class="keyword">return</span> y;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> g = gen(<span class="number">1</span>);</div><div class="line">g.next();</div><div class="line">g.throw(<span class="string">'出错了'</span>);  <span class="comment">// 出错了</span></div></pre></td></tr></table></figure>
<p>generator函数体外，throw抛出的错误可以被函数体内的try …catch捕获。也就是出错的代码和处理错误的代码，实现了时间和空间的分离。</p>
<h4 id="Generator实例"><a href="#Generator实例" class="headerlink" title="Generator实例"></a>Generator实例</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> fetch = <span class="built_in">require</span>(<span class="string">'node-fetch'</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> url = <span class="string">'http://api.github.com/github'</span>;</div><div class="line">  <span class="keyword">let</span> result = <span class="keyword">yield</span> fetch(url);</div><div class="line">  <span class="built_in">console</span>.log(result.bio);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> g = gen();</div><div class="line"><span class="keyword">let</span> result = g.next();</div><div class="line"></div><div class="line">result.value</div><div class="line">  .then( <span class="function"><span class="params">data</span> =&gt;</span> data.json() )</div><div class="line">  .then( <span class="function"><span class="params">data</span> =&gt;</span> g.next(data) );</div></pre></td></tr></table></figure>
<p>上面代码中，首先执行generator获取指针对象，然后使用next方法执行异步的第一阶段，得到了没有jsonparse的result，因为fetch返回的是promise对象，所有使用then调用下一个next方法。先将得到的result给JSON.parse()，然后把parse后的值作为上个阶段异步任务返回的值传到函数体内（此时函数体内的result成了第二个then传入进的data值，也就是parse后的result），然后执行<code>console.log(result.bio);</code></p>
<h4 id="基于promise对象的自动执行"><a href="#基于promise对象的自动执行" class="headerlink" title="基于promise对象的自动执行"></a>基于promise对象的自动执行</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> readFile = <span class="function"><span class="keyword">function</span>(<span class="params">fileName</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</div><div class="line">        fs.readFile(fileName, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</div><div class="line">            <span class="keyword">if</span>(err) reject(err)</div><div class="line">                resolve(data)</div><div class="line">        &#125;)</div><div class="line">    &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> gen = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> f1 = <span class="keyword">yield</span> readFile(<span class="string">'./nihao.txt'</span>)</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'我被执行了吗？'</span>)</div><div class="line">    <span class="keyword">var</span> f2 = <span class="keyword">yield</span> readFile(<span class="string">'./package.json'</span>)</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'我被输出了吗/'</span>)</div><div class="line">    <span class="built_in">console</span>.log(f1.toString())</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'我是粉丝'</span>)</div><div class="line">    <span class="built_in">console</span>.log(f2.toString())</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> g = gen()</div><div class="line"></div><div class="line">g.next().value.then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;  </div><div class="line">    <span class="comment">// g.next()  // &#123; value: 'hini', done: false&#125;</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'woshi'</span> + data)</div><div class="line">    <span class="comment">// g.next(data)  // &#123; value: 'package.json' , done: false&#125;</span></div><div class="line">    g.next(data).value.then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'我是什么时候执行的啊'</span> + data)</div><div class="line">        <span class="comment">// g.next(data)  // &#123; value: undefined, done: true&#125;</span></div><div class="line">        g.next(data)</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'我呢?'</span>)</div><div class="line">    &#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// 'woshihini'</span></div><div class="line"><span class="comment">// </span></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"> *  g.next()的时候，返回了&#123; value: 'hini', done: false&#125;</div><div class="line">    .value也就是'hini'因为是promise对象，所以用then方法，将hini作为data传入</div><div class="line">    console.log('woshi' data)  // woshihini</div><div class="line">    然后再次执行g.next(data)</div><div class="line">    f1 = 'nihi'</div><div class="line">    console.log('我被执行了吗？')</div><div class="line">    console.log('我是什么时候执行的啊' + data)</div><div class="line">    返回了&#123; value: 'package.json', done: false&#125;</div><div class="line">    再次执行g.next(data)</div><div class="line">    f2 = 'package.json'</div><div class="line">    console.log('我被输出了吗？')</div><div class="line">    console.log(f1.toString)</div><div class="line">    console.log('我是粉丝')</div><div class="line">    console.log(f2.toString)</div><div class="line">    然后返回&#123; value: undefined, done: true&#125;</div><div class="line">    console.log('我呢')</div><div class="line"></div><div class="line">    tips: next参数会被当作上一个yield语句的返回值。</div><div class="line">    执行第一个g.next() 返回值是&#123; value: 'hini', done: false&#125;</div><div class="line">    然后因为是promise对象，所以使用then方法，将.value最为data参数</div><div class="line">    然后再次执行g.next(data) 这个时候data为'hini' 把这个data最为上一个yield语句的返回值，然后执行下面的语句</div><div class="line">    也就是  f1 = data 然后next到下一个yield</div><div class="line">    然后获取到下一个yield的值也就是'package.json'，作为promise对象的data传入，</div><div class="line">    执行g.next(data)的时候，执行的时候将data作为上一个yield的返回值，也就是执行</div><div class="line">    var f2 = 'package.json'</div><div class="line">    然后执行下面的console.log</div><div class="line"> */</div></pre></td></tr></table></figure>
<p>上面代码是通过then方法层层添加回调，手动执行。相对这点，就可以写出一个自动执行器函数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">gen</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> g = gen();</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> result = g.next(data); </div><div class="line"></div><div class="line">    <span class="keyword">if</span> (result.done) <span class="keyword">return</span> result.value;</div><div class="line">        result.value.then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">        next(data);</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    next();</div><div class="line">&#125;</div><div class="line"></div><div class="line">run(gen);</div><div class="line"></div><div class="line"><span class="comment">// 第一步g.next(data)  返回&#123; value: 'hini', done: false&#125; 指针指到var f1 = yiedl</span></div><div class="line"><span class="comment">// 第二步next(data)  g.next(data) 把data也就是result.value: 'hini'当作上一个阶段的返回值，然后执行下面的语句</span></div><div class="line"><span class="comment">// var f1 = 'hini'  然后执行到下一个yield 返回 &#123; value: 'package.json', done: false&#125;</span></div><div class="line"><span class="comment">// 第三步next(data)  g.next(data) 把data也就是result.value: 'package.json'当作上一个阶段的返回值，然后执行下面的语句</span></div><div class="line"><span class="comment">// var f2= 'package.json'  console.log(...)  console.log(...)</span></div><div class="line"><span class="comment">// 但是这个时候done还是false，所以继续g.next()一次，返回 undefined</span></div></pre></td></tr></table></figure></p>
<p>上面代码中，只要generator函数没有执行到最后一步，next函数就调用自身，实现自动执行。</p>
<h3 id="Co"><a href="#Co" class="headerlink" title="Co"></a>Co</h3><blockquote>
<p>使用co的前提条件是，generator函数的yield命令后面，只能是thunk函数或promise对象。</p>
</blockquote>
<h4 id="关于co"><a href="#关于co" class="headerlink" title="关于co"></a>关于co</h4><p>co是上面自动执行函数的扩展，接收generator函数作为参数，返回一个promise对象，然后通过co自身的next反复调用。</p>
<h4 id="基于co的自动执行"><a href="#基于co的自动执行" class="headerlink" title="基于co的自动执行"></a>基于co的自动执行</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"><span class="keyword">const</span> co = <span class="built_in">require</span>(<span class="string">'co'</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> readFile = <span class="function"><span class="params">fileName</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">  fs.readFile(fileName, (err, data) =&gt; &#123;</div><div class="line">    <span class="keyword">if</span>(err) reject(err)</div><div class="line">    resolve(data)</div><div class="line">  &#125;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">const</span> gen = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">let</span> f1 = <span class="keyword">yield</span> readFile(<span class="string">'./nihao.txt'</span>)</div><div class="line">  <span class="keyword">let</span> f2 = <span class="keyword">yield</span> readFile(<span class="string">'package.json'</span>)</div><div class="line">  <span class="built_in">console</span>.log(f1.toString())</div><div class="line">  <span class="built_in">console</span>.log(f2.toString())</div><div class="line">&#125;</div><div class="line"></div><div class="line">co(gen)</div></pre></td></tr></table></figure>
<h4 id="并发的异步操作"><a href="#并发的异步操作" class="headerlink" title="并发的异步操作"></a>并发的异步操作</h4><p>co支持并发的异步操作，即允许某些操作同时进行，等到它们全部完成，才进行下一步。这时，要把并发的操作都放在数组或对象里面。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 数组的写法</span></div><div class="line">co(<span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> res = <span class="keyword">yield</span> [</div><div class="line">    <span class="built_in">Promise</span>.resolve(<span class="number">1</span>),</div><div class="line">    <span class="built_in">Promise</span>.resolve(<span class="number">2</span>)</div><div class="line">  ]</div><div class="line">  <span class="built_in">console</span>.log(res)</div><div class="line">&#125;).catch(onerror)</div><div class="line"></div><div class="line"><span class="comment">// 对象的写法</span></div><div class="line">co(<span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> res = <span class="keyword">yield</span> &#123;</div><div class="line">    <span class="number">1</span>: <span class="built_in">Promise</span>.resolve(<span class="number">1</span>),</div><div class="line">    <span class="number">2</span>: <span class="built_in">Promise</span>.resolve(<span class="number">2</span>)</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">console</span>.log(res)</div><div class="line">&#125;).catch(onerror)</div></pre></td></tr></table></figure>
<h3 id="Async"><a href="#Async" class="headerlink" title="Async"></a>Async</h3><blockquote>
<p>async函数就是generator函数的语法糖。</p>
</blockquote>
<h4 id="关于async"><a href="#关于async" class="headerlink" title="关于async"></a>关于async</h4><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">const asyncReadFile = async function ()&#123;</div><div class="line">  let f1 = await readFile('nihao.txt')</div><div class="line">  let f2 = await readFile('package.json)</div><div class="line">  console.log(f1.toString())</div><div class="line">  console.log(f2.toString())</div><div class="line">&#125;</div><div class="line"></div><div class="line">asyncReadFile()</div></pre></td></tr></table></figure>
<p>把之前的readFile写成async函数就是这样。比较之后发现，async函数就是将generator函数的星号（＊）替换成async，将yield替换成了await。generator函数的执行必须靠执行器，才有了co函数库，而async函数自带执行器，与普通函数一摸一样，而且async的语义更好，适用性更广，在async函数的await命令后面，可以跟Promise对象和原始类型的值。</p>
<h4 id="async例子"><a href="#async例子" class="headerlink" title="async例子"></a>async例子</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeout</span>(<span class="params">ms</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</div><div class="line">    setTimeout(resolve, ms)</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncprint</span>(<span class="params">value, ms</span>) </span>&#123;</div><div class="line">  <span class="keyword">await</span> timeout(ms)</div><div class="line">  <span class="built_in">console</span>.log(value)</div><div class="line">&#125;</div><div class="line"></div><div class="line">asyncprint(<span class="string">'hello'</span>, <span class="number">5000</span>)</div></pre></td></tr></table></figure>
<p>上面的代码指定5s后，输出’hello’。</p>
<p>同generator函数一样，async函数返回一个promise对象，可以使用then方法添加回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">getStockPriceByName(<span class="string">'goog'</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(result);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>另外要注意的是，await命令后面的promise对象，运行结果可能是rejected，所以最好把await命令放在try…catch代码块中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">myFunction</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">await</span> sonethingPromise()</div><div class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</div><div class="line">    <span class="built_in">console</span>.log(err)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 另一种写法</span></div><div class="line"></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">myFunction</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">await</span> sonethingPromise().catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(err)</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果希望多个请求并发执行，可以使用<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" target="_blank" rel="external">Promise.all</a>方法</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/06/ECMAScript6 import extends/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ant">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/06/ECMAScript6 import extends/" itemprop="url">
                  ECMAScript6 import extends
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-06T22:39:15+08:00">
                2017-01-06
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="关于import-export"><a href="#关于import-export" class="headerlink" title="关于import export"></a>关于import export</h3><blockquote>
<p>ES6模块的设计思想，是尽量的静态化，使得编译时就能确定模块的依赖关系，以及输入和输出的变量。</p>
</blockquote>
<p>假设我们有两个js文件：<code>index.js</code>和<code>content.js</code>，现在我们想要在<code>index.js</code>中使用<code>content.js</code>返回的结果，我们要怎么做呢？</p>
<h4 id="传统的CommonJS写法"><a href="#传统的CommonJS写法" class="headerlink" title="传统的CommonJS写法"></a>传统的CommonJS写法</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// index.js</span></div><div class="line"><span class="keyword">let</span> animal = <span class="built_in">require</span>(<span class="string">'./content.js'</span>)</div><div class="line"></div><div class="line"><span class="comment">// content.js</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="string">'A cat'</span></div></pre></td></tr></table></figure>
<h4 id="ES6的写法"><a href="#ES6的写法" class="headerlink" title="ES6的写法"></a>ES6的写法</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// index.js</span></div><div class="line"><span class="keyword">import</span> animal <span class="keyword">from</span> <span class="string">'./content'</span></div><div class="line"></div><div class="line"><span class="comment">// content.js</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">'A cat'</span></div></pre></td></tr></table></figure>
<h3 id="ES6-module的高级用法"><a href="#ES6-module的高级用法" class="headerlink" title="ES6 module的高级用法"></a>ES6 module的高级用法</h3><blockquote>
<p>export命令除了输出变量，还可以输出函数，甚至是类</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// index.js</span></div><div class="line"><span class="keyword">import</span> &#123; say, type &#125; <span class="keyword">from</span> <span class="string">'./content'</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> says = say()</div><div class="line"><span class="built_in">console</span>.log(<span class="string">`this <span class="subst">$&#123;type&#125;</span> says $(says)`</span>)  <span class="comment">// The dog says Hello</span></div><div class="line"></div><div class="line"><span class="comment">// content.js</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">'A cat'</span></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="string">'Hello'</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> type = <span class="string">'dog'</span></div></pre></td></tr></table></figure>
<p>输入的时候要注意：大括号里的变量名，必须与被倒入模块对外接口的名称想通过。</p>
<p>如果还希望输入content.js中输出的默认值（default），可以写在大括号外面。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// index.js</span></div><div class="line"><span class="keyword">import</span> animal, &#123; say, type &#125; <span class="keyword">from</span> <span class="string">'./content'</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> says = say()</div><div class="line"><span class="built_in">console</span>.log(<span class="string">`The <span class="subst">$&#123;type&#125;</span> says <span class="subst">$&#123;says&#125;</span> to <span class="subst">$&#123;animal&#125;</span>`</span>)  <span class="comment">// The dog says Hello to A cat</span></div></pre></td></tr></table></figure>
<h4 id="修改变量名"><a href="#修改变量名" class="headerlink" title="修改变量名"></a>修改变量名</h4><blockquote>
<p>在ES6中可以用as实现换名。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// index.js</span></div><div class="line"><span class="keyword">import</span> animal, &#123; say, type <span class="keyword">as</span> animalType &#125; <span class="keyword">from</span> <span class="string">'./content'</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> says = say()</div><div class="line"><span class="built_in">console</span>.log(<span class="string">`hello <span class="subst">$&#123;animalType&#125;</span> say <span class="subst">$&#123;says&#125;</span> to <span class="subst">$&#123;animal&#125;</span>`</span>)  <span class="comment">// hello dog says Hello to A cat</span></div></pre></td></tr></table></figure>
<h4 id="模块的整体加载"><a href="#模块的整体加载" class="headerlink" title="模块的整体加载"></a>模块的整体加载</h4><blockquote>
<p>使用星号（ * ）指定一个对象，所有输出的值都加载到这个对象上。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// index.js  这里的animal还是指代默认输出的接口</span></div><div class="line"><span class="keyword">import</span> animal, * <span class="keyword">as</span> content <span class="keyword">from</span> <span class="string">'./content'</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> says = content.say()</div><div class="line"><span class="built_in">console</span>.log(<span class="string">`hello <span class="subst">$&#123;content.type&#125;</span> says <span class="subst">$&#123;says&#125;</span> to <span class="subst">$&#123;animal&#125;</span>`</span>)  <span class="comment">// hello dog says Hello to A cat</span></div></pre></td></tr></table></figure>
<p>通常星号<code>*</code>结合<code>as</code>一起使用比较合适</p>
<h4 id="Tree-shaking"><a href="#Tree-shaking" class="headerlink" title="Tree-shaking"></a>Tree-shaking</h4><p>打包时忽略没有使用到的变量，我们可以使用<a href="http://rollupjs.org/" target="_blank" rel="external">rollup.js</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/06/ES6 使用教程/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ant">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/06/ES6 使用教程/" itemprop="url">
                  ES6 使用教程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-06T22:38:16+08:00">
                2017-01-06
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="let-const"><a href="#let-const" class="headerlink" title="let, const"></a>let, const</h3><h4 id="let"><a href="#let" class="headerlink" title="let"></a>let</h4><blockquote>
<p>声明带有块级作用域的变量</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++) &#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(i)    <span class="comment">//5 5 5 5 5 </span></div><div class="line">  &#125;, <span class="number">2000</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们想在2s后输出0, 1, 2, 3, 4,，可输出的结果却不是这样。这是因为var声明循环变量泄漏为全局变量。每一次循环，新的i值都会覆盖旧值，导致最后输出的是最后一轮的i值。<br>使用let 就可以很好的解决这个问题。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++) &#123;</div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(i)  <span class="comment">// 0 1 2 3 4 </span></div><div class="line">  &#125;, <span class="number">2000</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当然我们也可以用闭包来解决。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++) &#123;</div><div class="line">  setTimeout((<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(i)</div><div class="line">  &#125;)(i), <span class="number">2000</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="const"><a href="#const" class="headerlink" title="const"></a>const</h4><blockquote>
<p>声明带有块级作用域且不可修改的常量</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> PI = <span class="built_in">Math</span>.PI</div><div class="line"></div><div class="line">PI = <span class="number">23</span>  <span class="comment">//SyntaxError</span></div></pre></td></tr></table></figure>
<p>一旦尝试修改const声明的常量，浏览器就会报错。</p>
<h3 id="class-extends-super"><a href="#class-extends-super" class="headerlink" title="class, extends, super"></a>class, extends, super</h3><blockquote>
<p>原型、构造函数、继承</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nico</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>() &#123;</div><div class="line">    <span class="keyword">this</span>.name = <span class="string">'nico'</span></div><div class="line">  &#125;</div><div class="line">  say(say) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> say <span class="subst">$&#123;say&#125;</span>`</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> nico = <span class="keyword">new</span> Nico()</div><div class="line">nico.say(<span class="string">'nihaoa'</span>)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Kotori</span> <span class="keyword">extends</span> <span class="title">Nico</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>() &#123;</div><div class="line">    <span class="keyword">super</span>()</div><div class="line">    <span class="keyword">this</span>.name = <span class="string">'kotori'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> kotori = <span class="keyword">new</span> Kotori()</div><div class="line">kotori.say(<span class="string">'nihaoa'</span>)</div></pre></td></tr></table></figure>
<p>首先用class定义了一个’类’，通过constructor构造方法，this代表着实例对象。constructor内定义的方法和属性是实例对象自己的而constructor外定义的方法和属性则是所有实例对象可以共享的。</p>
<p>Class之间可以通过extends实现继承。</p>
<p>Sper代指父类的实例（即父类的this对象）。如果不调用super方法，子类就得不到this对象。因为子类没有自己的this对象，而是继承父类的this对象。所以子类必须在constructor中调用super方法，然后对其进行加工。</p>
<p>ES6的继承机制，是先创造父类的实例对象this（所以必须调用super方法），然后再用子类的构造函数修改this。</p>
<h3 id="arrow-function"><a href="#arrow-function" class="headerlink" title="arrow function"></a>arrow function</h3><blockquote>
<p>解决this的指向问题。箭头函数体内的this对象，就是定义时所在的对象，而不是使用时所在的对象。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>()&#123;</div><div class="line">    <span class="keyword">this</span>.type = <span class="string">'animal'</span></div><div class="line">  &#125;</div><div class="line">  says(say) &#123;  <span class="comment">// Animal.says</span></div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.type + <span class="string">'say'</span> + say)  <span class="comment">// undefind say nico</span></div><div class="line">    &#125;,<span class="number">1000</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> animal = <span class="keyword">new</span> Animal()</div><div class="line">animal.says(<span class="string">'nico'</span>)</div></pre></td></tr></table></figure>
<p>我们想在调用says方法的时候输出animal say nico，可是结果却不对。这是因为setTimeout中的this指向的是全局对象。<br>我们可以用传统的两种方法来解决这个问题。第一种： 把this传给self，再用self代指this<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">says(say) &#123;</div><div class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span></div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(self.type)</div><div class="line">  &#125;, <span class="number">2000</span>)</div></pre></td></tr></table></figure></p>
<p>第二种：使用bind<br><figure class="highlight plain"><figcaption><span>&#123;</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">setTimeout(function() &#123;</div><div class="line">  console.log(this.type)</div><div class="line">&#125;.bind(this), 2000)</div></pre></td></tr></table></figure></p>
<p>但是这样太麻烦，使用箭头函数就可以免去这些麻烦的来解决这个问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>()&#123;</div><div class="line">    <span class="keyword">this</span>.type = <span class="string">'animal'</span></div><div class="line">  &#125;</div><div class="line">  says(say) &#123;</div><div class="line">    setTimeout( <span class="function"><span class="params">()</span>=&gt;</span> &#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.type + <span class="string">'say'</span> + say)</div><div class="line">    &#125;,<span class="number">1000</span>)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> animal = <span class="keyword">new</span> Animal()</div><div class="line">animal.says(<span class="string">'nico'</span>)</div></pre></td></tr></table></figure>
<p>当我们使用箭头函数的时候，函数体内的this对象，就是定义时所在的对象，而不是使用时所在的对象。并不是箭头函数内部有绑定this的机制，实际原因是箭头函数根本没有自己的this，它的this是继承外面的，因此内部的this就是外层代码块的this。</p>
<h3 id="template-string"><a href="#template-string" class="headerlink" title="template string"></a>template string</h3><blockquote>
<p>用｀反引号来标识起始，用${}来引用变量，所有的空格和缩进都会被保留在输出之中。</p>
</blockquote>
<h3 id="destructuring"><a href="#destructuring" class="headerlink" title="destructuring"></a>destructuring</h3><blockquote>
<p>从数组和对象中提取值，对变量进行赋值，这被称之为解构（Destructuring）。</p>
</blockquote>
<p>看下面的例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> cat = <span class="string">'cat'</span></div><div class="line"><span class="keyword">let</span> dog = <span class="string">'dog'</span></div><div class="line"><span class="keyword">let</span> zoo = &#123; <span class="attr">cat</span>:cat, <span class="attr">dog</span>: dog &#125;</div></pre></td></tr></table></figure></p>
<p>用ES6完全可以像下面这么写：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> cat = <span class="string">'cat'</span></div><div class="line"><span class="keyword">let</span> dog = <span class="string">'dog'</span></div><div class="line"><span class="keyword">let</span> zoo = &#123; cat, dog &#125;  <span class="comment">// zoo.cat = cat, zoo.dog = dog</span></div></pre></td></tr></table></figure></p>
<p>反过来可以这么写：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> dog = &#123; <span class="attr">type</span>: <span class="string">'animal'</span>, <span class="attr">many</span>: <span class="number">2</span> &#125;</div><div class="line"><span class="keyword">let</span> &#123; type, many &#125; = dog  <span class="comment">// type = dog.type, many = dog.many</span></div></pre></td></tr></table></figure></p>
<h3 id="default-rest"><a href="#default-rest" class="headerlink" title="default, rest"></a>default, rest</h3><h4 id="default"><a href="#default" class="headerlink" title="default"></a>default</h4><blockquote>
<p>更方便的指定默认值。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">animal</span>(<span class="params">type = <span class="string">'cat'</span></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(type)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="rest"><a href="#rest" class="headerlink" title="rest"></a>rest</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">animals</span>(<span class="params">...types</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(types)</div><div class="line">&#125;</div><div class="line">animals(<span class="string">'nico'</span>, <span class="string">'nino'</span>, <span class="string">'arashi'</span>)  <span class="comment">// ['nico', 'nino', 'arashi']</span></div></pre></td></tr></table></figure>
<p>如果不用ES6的话，我们则需要使用ES5 的arguments。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/05/ECMAScrpit6 学习笔记/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ant">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/05/ECMAScrpit6 学习笔记/" itemprop="url">
                  ECMAScrpit6 学习笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-05T23:20:43+08:00">
                2017-01-05
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="let-and-const"><a href="#let-and-const" class="headerlink" title="let and const"></a>let and const</h2><h3 id="let"><a href="#let" class="headerlink" title="let"></a>let</h3><blockquote>
<p>原来的javascript中没有块级作用域，只有函数级作用域。在es6中，使用let声明的变量具有块级作用域。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(<span class="literal">true</span>) &#123;  <span class="comment">//  if不是函数，没有块级作用域</span></div><div class="line">  <span class="keyword">var</span> nico = <span class="string">'nico'</span></div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'nihao'</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(nico)  <span class="comment">// 'nico'</span></div><div class="line"></div><div class="line"><span class="comment">// 隔壁二狗说，我要块级作用域</span></div><div class="line"><span class="keyword">if</span>(<span class="literal">true</span>) &#123;</div><div class="line">  <span class="keyword">let</span> nico = <span class="string">'nico'</span></div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'nihao'</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(nico)  <span class="comment">// undefined</span></div></pre></td></tr></table></figure>
<h3 id="const"><a href="#const" class="headerlink" title="const"></a>const</h3><blockquote>
<p>const也具有块级作用域，且const声明的值不可修改</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> NICO_AGE = <span class="number">12</span></div><div class="line">NICO_AGE = <span class="number">18</span>  <span class="comment">//SyntaxError</span></div></pre></td></tr></table></figure>
<h2 id="Template-String"><a href="#Template-String" class="headerlink" title="Template String"></a>Template String</h2><blockquote>
<p>空格和换行都会被保留</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 传统的字符串</span></div><div class="line"><span class="keyword">var</span> name = <span class="string">'es6'</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> sayhello = <span class="string">'hello,my name is '</span> + name</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(sayhello)</div><div class="line"></div><div class="line"><span class="comment">// 隔壁二狗说，要优雅</span></div><div class="line"><span class="keyword">let</span> name = <span class="string">'es6'</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> sayHello = <span class="string">`hello, my name is <span class="subst">$&#123;name&#125;</span>`</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(sayHello)</div></pre></td></tr></table></figure>
<h2 id="Arrow-Function"><a href="#Arrow-Function" class="headerlink" title="Arrow Function"></a>Arrow Function</h2><blockquote>
<p>箭头函数自动绑定当前上下文的this</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(a + b);</div><div class="line">    <span class="keyword">return</span> a + b;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 隔壁二狗说，嗯哼，麻烦</span></div><div class="line"> (a,b) =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(a + b)</div><div class="line">  <span class="keyword">return</span> a + b</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><blockquote>
<p>原生的 Promise 实现，不再需要 bluebird 或 Q+。</p>
</blockquote>
<h2 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h2><blockquote>
<p>Generator生成器允许你通过写一个可以保存自己状态的简单函数来定义一个迭代算法。和Generator一起出现的通常还有yield。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> *<span class="title">gen</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">yield</span> <span class="string">'hello'</span></div><div class="line">  <span class="keyword">yield</span> <span class="string">'world'</span></div><div class="line">  <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Generator（迭代生成器）与普通函数的区别是function关键字后面有个*号，函数体内可以使用yield语句进行流程控制</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> iter = gen()</div><div class="line"><span class="keyword">let</span> a = iter.next()</div><div class="line"><span class="built_in">console</span>.log(a)  <span class="comment">// &#123;value: 'hello', done: false&#125;</span></div><div class="line"><span class="keyword">let</span> b = iter.next()</div><div class="line"><span class="built_in">console</span>.log(b)  <span class="comment">// &#123;value: 'world', done: false&#125;</span></div><div class="line"><span class="keyword">let</span> c = iter.next()</div><div class="line"><span class="built_in">console</span>.log(c)  <span class="comment">// &#123;value: true, done: true&#125;</span></div></pre></td></tr></table></figure>
<p>执行gen()的时候，返回一个迭代器iterator，迭代器具有next()方法，每次调用next()，函数就执行到yield语句的地方。next()方法返回一个对象，value属性表示yield关键字后面表达式的值，done属性表示是否遍历结束。generator生成器通过next和yield的配合实现流程控制，上面的代码执行了三次next()，generator函数体才执行完毕。</p>
<h2 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h2><blockquote>
<p>在Javascript中引入OO面向对象。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Point</span>(<span class="params">x,y</span>)</span>&#123;</div><div class="line">  <span class="keyword">this</span>.x = x</div><div class="line">  <span class="keyword">this</span>.y = y</div><div class="line">&#125;</div><div class="line"></div><div class="line">Point.prototype.toString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="string">'('</span> + <span class="keyword">this</span>.x + <span class="string">', '</span> + <span class="keyword">this</span>.y + <span class="string">')'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> lent = <span class="keyword">new</span> Point(<span class="number">1</span>, <span class="number">5</span>)</div><div class="line"><span class="built_in">console</span>.log(lent.toString())</div><div class="line"></div><div class="line"><span class="comment">// 隔壁二狗说，我要Class</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(x ,y) &#123;</div><div class="line">    <span class="keyword">this</span>.x = x</div><div class="line">    <span class="keyword">this</span>.y = y</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  toString() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">`(<span class="subst">$&#123;<span class="keyword">this</span>.x&#125;</span>, <span class="subst">$&#123;<span class="keyword">this</span>.y&#125;</span>)`</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> pointo = <span class="keyword">new</span> Point(<span class="number">1</span>, <span class="number">5</span>)</div><div class="line"><span class="built_in">console</span>.log(pointo.toString())</div></pre></td></tr></table></figure>
<h2 id="ES6-Module"><a href="#ES6-Module" class="headerlink" title="ES6 Module"></a>ES6 Module</h2><h3 id="export-and-import"><a href="#export-and-import" class="headerlink" title="export and import"></a>export and import</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">let</span> firstName = <span class="string">'arashi'</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">let</span> lastName = <span class="string">'nico'</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">let</span> year = <span class="number">2017</span></div><div class="line"></div><div class="line"><span class="comment">/* index.js */</span></div><div class="line"><span class="keyword">import</span> &#123; firstName, lastName, year&#125; <span class="keyword">from</span> <span class="string">'./lls'</span></div></pre></td></tr></table></figure>
<h3 id="模块整体输出"><a href="#模块整体输出" class="headerlink" title="模块整体输出"></a>模块整体输出</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> firstName = <span class="string">'nico'</span></div><div class="line"><span class="keyword">let</span> lastName = <span class="string">'arashi'</span></div><div class="line"><span class="keyword">let</span> year = <span class="number">2017</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> &#123; firstName, lastName, year&#125;</div><div class="line"></div><div class="line"><span class="comment">/* index.js */</span></div><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Lls <span class="keyword">from</span> <span class="string">'./lls'</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(Lls.firstName,Lls.lastName, Lls.year)</div></pre></td></tr></table></figure>
<h3 id="export-default整体输出"><a href="#export-default整体输出" class="headerlink" title="export default整体输出"></a>export default整体输出</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'My name is nico'</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* index.js */</span></div><div class="line"><span class="keyword">import</span> sayName <span class="keyword">from</span> <span class="string">'./lls'</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(sayName())</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/04/Redux API使用教程/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ant">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/04/Redux API使用教程/" itemprop="url">
                  Redux API使用教程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-04T22:51:38+08:00">
                2017-01-04
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="compose"><a href="#compose" class="headerlink" title="compose"></a>compose</h3><blockquote>
<p>它是一个没有依赖的纯函数</p>
</blockquote>
<pre>compose(f, g, h)(...arg) => f(g(h（...arg)))</pre>

<p>使用实例:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">func1</span>(<span class="params">num</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'func1'</span> + num)</div><div class="line">    <span class="keyword">return</span> num + <span class="number">1</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">func2</span>(<span class="params">num</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'func2'</span> + num)</div><div class="line">    <span class="keyword">return</span> num + <span class="number">2</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">func3</span>(<span class="params">num</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'func3'</span> + num)</div><div class="line">    <span class="keyword">return</span> num + <span class="number">3</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> re1 = func3(func2(func1(<span class="number">0</span>)))</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'re1'</span> + re1)  <span class="comment">// 0 1 3 6</span></div><div class="line"></div><div class="line"><span class="comment">// 隔壁二狗子说，要优雅</span></div><div class="line"><span class="keyword">let</span> re2 = Redux.compose(func3, func2, func1)(<span class="number">0</span>)</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'re2'</span> + re2)  <span class="comment">// 结果同上</span></div></pre></td></tr></table></figure></p>
<h3 id="createStore"><a href="#createStore" class="headerlink" title="createStore"></a>createStore</h3><blockquote>
<p>创建store</p>
</blockquote>
<p>使用实例:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> &#123; createStore &#125; = Redux</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</div><div class="line">    <span class="comment">// ...reducer处理过程</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> store = createStore(reducer)</div><div class="line">store.getState()</div></pre></td></tr></table></figure></p>
<h3 id="combineReducers"><a href="#combineReducers" class="headerlink" title="combineReducers"></a>combineReducers</h3><blockquote>
<p>将多个reducer的状态合并</p>
</blockquote>
<p>使用实例:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">function reducer(state = &#123;counter:0, todos: []&#125;, action) &#123;</div><div class="line">    switch(action.type) &#123;</div><div class="line">        case 'ADD_TODO':</div><div class="line">            return &#123;</div><div class="line">                ...state,</div><div class="line">                todos: state.todos.push(action.type)</div><div class="line">            &#125;</div><div class="line">        case 'INCREMENT':</div><div class="line">            return &#123;</div><div class="line">                ...state,</div><div class="line">                counter: state.counter+1</div><div class="line">            &#125;    </div><div class="line">        default:</div><div class="line">            return state</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 隔壁二狗子说，随着逻辑越来越多，代码也会变得臃肿，而我喜欢优雅</div><div class="line"></div><div class="line">/*</div><div class="line"> * 目录结构如下</div><div class="line"> * reducers/</div><div class="line"> *     |-- index.js</div><div class="line"> *     |-- counterReducer.js</div><div class="line"> *     |-- todosReducer.js</div><div class="line"> */</div><div class="line"></div><div class="line">import &#123; combineReducers &#125; from 'redux</div><div class="line">import counterReducer from './counterReducer'</div><div class="line">import todosReducer from './todosReducer'</div><div class="line"></div><div class="line">const rootReducer = combineReducers(&#123;  // 合并后，就成了state.counter,state.todos</div><div class="line">    counter: counterReducer,</div><div class="line">    todos: todosReducer</div><div class="line">&#125;)</div><div class="line"></div><div class="line">/* reducers/counterReducer.js */</div><div class="line">export default function counterReducer(counter = 0, action) &#123;</div><div class="line">    switch(action.type) &#123;</div><div class="line">        case 'INCREMENT':</div><div class="line">            return counter + 1</div><div class="line">        default:</div><div class="line">            return counter</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">/* reducers/todosReducer */</div><div class="line">export default function todosReducer(todos = [], action) &#123;</div><div class="line">    switch(action.type) &#123;</div><div class="line">        case 'ADD_TODO':</div><div class="line">            return [</div><div class="line">                ...todos,</div><div class="line">                action.payload</div><div class="line">            ]</div><div class="line">         default:</div><div class="line">             return todos</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="bindActionCreators"><a href="#bindActionCreators" class="headerlink" title="bindActionCreators"></a>bindActionCreators</h3><blockquote>
<p>dispatch(ActionCreator(xxx)) 自动dispatch</p>
</blockquote>
<p>使用实例:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'#btn'</span>).on(<span class="string">'click'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">let</span> content = $(<span class="string">'#todoInput'</span>).val()</div><div class="line">    <span class="keyword">let</span> action = addTodo(content)  <span class="comment">// 执行Action Creator 获取 action &#123;type: 'xxx'&#125;</span></div><div class="line">    store.dispatch(action)  <span class="comment">// 手动显示dispatch 一个 action</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// 调用addTodo这个Action Createtor后得到一个action， 之后又要手动dispatch这个action，隔壁二狗子说，太麻烦</span></div><div class="line"></div><div class="line"><span class="keyword">let</span> actionCreators = Redux.bindActionCreators(</div><div class="line">    &#123;<span class="attr">addTodo</span>: addTodo&#125;,</div><div class="line">    store.dispatch</div><div class="line">)</div><div class="line"></div><div class="line">$(<span class="string">'#btn'</span>).on(<span class="string">'click'</span>, () =&gt; &#123;</div><div class="line">    <span class="keyword">let</span> content = $(<span class="string">'#todoInput'</span>).val()</div><div class="line">    actionCreators.addTodo(content)  <span class="comment">// 自动dispatch</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="applyMiddleware"><a href="#applyMiddleware" class="headerlink" title="applyMiddleware"></a>applyMiddleware</h3><blockquote>
<p>中间件</p>
</blockquote>
<h4 id="applyMiddleware简明对比"><a href="#applyMiddleware简明对比" class="headerlink" title="applyMiddleware简明对比"></a>applyMiddleware简明对比</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> stateMiddleware = <span class="function">(<span class="params">&#123;getState&#125;</span>) =&gt;</span> next =&gt; action &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'state before dispatch'</span>, getState())</div><div class="line">    <span class="keyword">let</span> returnValue = next(action)</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'state after dispatch'</span>, getState())</div><div class="line">    <span class="keyword">return</span> returnValue</div><div class="line">&#125;</div><div class="line"></div><div class="line">===&gt;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">stateMiddleware</span>(<span class="params">middlewareAPI</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">dispatch</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">action</span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'state before dispatch'</span>, middlewareAPI.getState())</div><div class="line">            <span class="keyword">let</span> returnValue = dispatch(action)</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'state after dispatch'</span>, middlewareAPI.getState())</div><div class="line">            <span class="keyword">return</span> returnValue</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用实例:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">inc</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123; <span class="attr">type</span>: <span class="string">'INCREMENT'</span>&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dec</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123; <span class="attr">type</span>: <span class="string">'DECREMENT'</span>&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</div><div class="line">    state = state || &#123; <span class="attr">counter</span>: <span class="number">0</span> &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">switch</span>(action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'INCREMENT'</span>:</div><div class="line">            <span class="keyword">return</span> &#123;<span class="attr">counter</span>: state.counter + <span class="number">1</span>&#125;</div><div class="line">        <span class="keyword">case</span> <span class="string">'DECREMENT'</span>:</div><div class="line">            <span class="keyword">return</span> &#123;<span class="attr">counter</span>: state.counter - <span class="number">1</span>&#125;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> state</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> printStateMiddleware = <span class="function">(<span class="params">&#123;getState&#125;</span>) =&gt;</span> next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'dispatch 前'</span>, getState())</div><div class="line">    <span class="keyword">let</span> returnValue = next(action)</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'dispatch 后'</span>, getState())</div><div class="line">    <span class="keyword">return</span> returnValue</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">let</span> store = Redux.createStore(</div><div class="line">    reducer,</div><div class="line">    Redux.applyMiddleware(printStateMiddleware)</div><div class="line">)</div><div class="line"></div><div class="line">store.dispatch(inc());</div><div class="line">store.dispatch(inc());</div><div class="line">store.dispatch(dec());</div></pre></td></tr></table></figure></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>Redux 有五个<b>API</b>，分别是:</p>
<ul>
<li>createStore</li>
<li>combineReducers</li>
<li>applyMiddleware</li>
<li>bindActionCreators</li>
<li>compose</li>
</ul>
<p>createStore 生成的 store 有四个<b>API</b>，分别是：</p>
<ul>
<li>getState</li>
<li>dispatch</li>
<li>subscribe</li>
<li>replaceReducer</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/30/React-redux 入门实例(ruanyifeng)/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ant">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/30/React-redux 入门实例(ruanyifeng)/" itemprop="url">
                  React-redux 入门实例(ruanyifeng)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-30T22:21:58+08:00">
                2016-12-30
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="React-redux"><a href="#React-redux" class="headerlink" title="React-redux"></a>React-redux</h3><p>React-redux将组件分为两大类：UI组件和容器组件。</p>
<h4 id="UI组件特点："><a href="#UI组件特点：" class="headerlink" title="UI组件特点："></a>UI组件特点：</h4><ul>
<li>只负责UI的呈现，不带有任何的业务逻辑</li>
<li>没有状态（即不使用this.state属性）</li>
<li>所有数据都由参数（this.props）提供</li>
<li>不使用任何的Redux的API</li>
</ul>
<p>计数器例子的Counter组件就是一个UI组件，他所需要的数据在render里由props提供</p>
<h4 id="容器组件特点："><a href="#容器组件特点：" class="headerlink" title="容器组件特点："></a>容器组件特点：</h4><ul>
<li>负责管理数据和业务逻辑，不负责UI的呈现</li>
<li>带有内部状态</li>
<li>使用Redux的API</li>
</ul>
<p>换句话说，UI组件负责UI的呈现，容器组件负责管理数据和逻辑。<br>React-redux规定，所有的UI组件都由用户提供，容器组件则有React-redux自动生成。也就是说用户负责视觉层，状态管理全交给它。</p>
<h3 id="计数器"><a href="#计数器" class="headerlink" title="计数器"></a>计数器</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* reducer */</span></div><div class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state=<span class="number">0</span>, action</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">switch</span>(action.type) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'ADD'</span>:</div><div class="line">      <span class="keyword">return</span> state+<span class="number">1</span>;</div><div class="line">    <span class="keyword">case</span> <span class="string">'DEC'</span>:</div><div class="line">      <span class="keyword">return</span> state<span class="number">-1</span>;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      <span class="keyword">return</span> state;</div><div class="line">                    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/* 创建状态 */</span></div><div class="line"><span class="keyword">const</span> &#123; createStore &#125; = Redux;</div><div class="line"><span class="keyword">const</span> store = createStore(reducer);</div><div class="line"></div><div class="line"><span class="keyword">let</span> next = store.dispatch;</div><div class="line">store.dispatch = <span class="function"><span class="keyword">function</span> <span class="title">dispatchAndLog</span>(<span class="params">action</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'dispatching'</span>, action);</div><div class="line">  next(action);</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState());</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/* 然后构建Counter组件 */</span></div><div class="line"><span class="keyword">const</span> &#123; Component &#125; = React;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  render()&#123;</div><div class="line">    <span class="keyword">const</span> &#123;value, increment, deccrement&#125; = <span class="keyword">this</span>.props;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;div&gt;</div><div class="line">        &lt;h1&gt;&#123;value&#125;&lt;/h1&gt;</div><div class="line">        &lt;button onClick=&#123;increment&#125;&gt;+&lt;/button&gt;</div><div class="line">        &lt;button onClick=&#123;deccrement&#125;&gt;-&lt;/button&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/* 首先写好需要实时渲染的虚拟dom */</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> render = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  ReactDOM.render(</div><div class="line">    &lt;Counter </div><div class="line">      value=&#123;store.getState()&#125;</div><div class="line">      increment=&#123;() =&gt; &#123;</div><div class="line">            store.dispatch(&#123;</div><div class="line">              type: 'ADD'</div><div class="line">            &#125;)</div><div class="line">          &#125;&#125;</div><div class="line">      deccrement=&#123;() =&gt; &#123;</div><div class="line">            store.dispatch(&#123;</div><div class="line">              type: 'DEC'</div><div class="line">            &#125;)</div><div class="line">          &#125;&#125;</div><div class="line">      /&gt;,</div><div class="line">    document.getElementById('root')</div><div class="line">  )</div><div class="line">&#125;;</div><div class="line"></div><div class="line">/* 然后初始化执行render，并且监听render */</div><div class="line">render();</div><div class="line">store.subscribe(render);</div></pre></td></tr></table></figure>
<h3 id="使用connect和Provider来生成计数器"><a href="#使用connect和Provider来生成计数器" class="headerlink" title="使用connect和Provider来生成计数器"></a>使用connect和Provider来生成计数器</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> &#123; Component, PropTypes &#125; = React</div><div class="line"><span class="keyword">const</span> &#123; createStore &#125; = Redux</div><div class="line"><span class="keyword">const</span> &#123; Provider, connect &#125; = ReactRedux</div><div class="line"></div><div class="line"><span class="comment">/* UI层面 */</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">const</span> &#123; value, onIncreaseClick &#125; = <span class="keyword">this</span>.props</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;div&gt;</div><div class="line">    &lt;span&gt;&#123;value&#125;&lt;/span&gt;</div><div class="line">           &lt;button onClick=&#123;onIncreaseClick&#125;&gt;Increase&lt;/button&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  )</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Counter.propTypes = &#123;</div><div class="line">  <span class="attr">value</span>: PropTypes.number.isRequired,</div><div class="line">  <span class="attr">onIncreaseClick</span>: PropTypes.func.isRequired</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* value映射state，onIncreaseClick映射dispatch */</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">value</span>: state.count</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">onIncreaseClick</span>: <span class="function"><span class="params">()</span> =&gt;</span> dispatch(increaseAction)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// action</span></div><div class="line"><span class="keyword">const</span> increaseAction = &#123; <span class="attr">type</span>: <span class="string">'increase'</span> &#125;</div><div class="line"></div><div class="line"><span class="comment">/* 生成容器组件 */</span></div><div class="line"><span class="keyword">const</span> App = connect(</div><div class="line">  mapStateToProps,</div><div class="line">  mapDispatchToProps</div><div class="line">)(Counter)</div><div class="line"></div><div class="line"><span class="comment">/* reducer */</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">counter</span>(<span class="params">state = &#123;count: <span class="number">0</span>&#125;, action</span>) </span>&#123;</div><div class="line">  <span class="keyword">const</span> count = state.count;</div><div class="line">  <span class="keyword">switch</span>(action.type) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'increase'</span>: </div><div class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: count+<span class="number">1</span> &#125;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      <span class="keyword">return</span> state</div><div class="line">                    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> store = createStore(counter)</div><div class="line"></div><div class="line">ReactDOM.render(</div><div class="line">  &lt;Provider store=&#123;store&#125;&gt;</div><div class="line">    &lt;App /&gt;</div><div class="line">    &lt;/Provider&gt;,</div><div class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</div><div class="line">)</div></pre></td></tr></table></figure>
<p>mapStateToProps会订阅store，每当state更新时，就会重新计算UI组件的参数，从而触发UI组件的重新渲染。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/28/React 入门实例(ruanyifeng)/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="ant">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hexo" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/28/React 入门实例(ruanyifeng)/" itemprop="url">
                  React 入门实例(ruanyifeng)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Veröffentlicht am</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-28T23:51:31+08:00">
                2016-12-28
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、Hello-World"><a href="#一、Hello-World" class="headerlink" title="一、Hello World"></a>一、Hello World</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> &#123; render &#125; = ReactDOM;</div><div class="line"></div><div class="line">render(</div><div class="line">  &lt;h1&gt;Hello, world&lt;/h1&gt;,</div><div class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</div><div class="line">)</div></pre></td></tr></table></figure>
<h3 id="二、JSX语法"><a href="#二、JSX语法" class="headerlink" title="二、JSX语法"></a>二、JSX语法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> names = [<span class="string">'Alice'</span>, <span class="string">'Emily'</span>, <span class="string">'Kate'</span>];</div><div class="line"></div><div class="line">render(</div><div class="line">  &lt;div&gt;</div><div class="line">    &#123;</div><div class="line">    names.map(name =&gt; &#123;</div><div class="line">      return &lt;p&gt;hello &#123;name&#125;&lt;/p&gt;</div><div class="line">    &#125;)</div><div class="line">      &#125;</div><div class="line">    &lt;/div&gt;,</div><div class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</div><div class="line">)</div></pre></td></tr></table></figure>
<h3 id="三、组件"><a href="#三、组件" class="headerlink" title="三、组件"></a>三、组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> &#123; Component &#125; = React;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloMessage</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;h1&gt;Hello &#123;this.props.name&#125;&lt;/h1&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">render(</div><div class="line">  &lt;HelloMessage name='nico' /&gt;,</div><div class="line">  document.getElementById('root')</div><div class="line">)</div></pre></td></tr></table></figure>
<h3 id="四、this-props-children"><a href="#四、this-props-children" class="headerlink" title="四、this.props.children"></a>四、this.props.children</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> &#123; Component, Children &#125; = React;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloMessage</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;ol&gt;</div><div class="line">        &#123; Children.map(this.props.children, child=&gt; &lt;li&gt;&#123;child&#125;&lt;/li&gt;)&#125;    // Array.prototype.map(this.props.children, fn())</div><div class="line">       &lt;/ol&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">render(</div><div class="line">  &lt;HelloMessage&gt;</div><div class="line">    &lt;span&gt;hello&lt;/span&gt;</div><div class="line">    &lt;span&gt;world&lt;/span&gt;</div><div class="line">    &lt;/HelloMessage&gt;,</div><div class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</div><div class="line">)</div></pre></td></tr></table></figure>
<h3 id="五、defaultProps"><a href="#五、defaultProps" class="headerlink" title="五、defaultProps"></a>五、defaultProps</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloMessage</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="keyword">static</span> defaultProps = &#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'nico'</span></div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  render = <span class="function"><span class="params">()</span> =&gt;</span> (</div><div class="line">    &lt;h1&gt;Hello &#123;this.props.name&#125;&lt;/h1&gt;</div><div class="line">  );</div><div class="line">&#125;</div><div class="line"></div><div class="line">render(</div><div class="line">&lt;HelloMessage /&gt;,</div><div class="line">  document.getElementById('root')</div><div class="line">)</div></pre></td></tr></table></figure>
<h3 id="六、获取真实的节点"><a href="#六、获取真实的节点" class="headerlink" title="六、获取真实的节点"></a>六、获取真实的节点</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloMessage</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line"> handlerClick = <span class="function"><span class="params">()</span>=&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.input.value) </div><div class="line"> &#125;;</div><div class="line">render = <span class="function"><span class="params">()</span>=&gt;</span>(</div><div class="line">    &lt;div&gt;</div><div class="line">      &lt;input ref=&#123;node=&gt;this.input=node&#125; /&gt;</div><div class="line">      &lt;button onClick=&#123;this.handlerClick&#125;&gt;</div><div class="line">        Clickme</div><div class="line">      &lt;/button&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">  );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="七、state"><a href="#七、state" class="headerlink" title="七、state"></a>七、state</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloMessage</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">    state = &#123;</div><div class="line">      <span class="attr">liked</span>: <span class="literal">false</span></div><div class="line">   &#125;;</div><div class="line"></div><div class="line">  handleClick = <span class="function"><span class="params">()</span>=&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.setState(&#123;</div><div class="line">      <span class="attr">liked</span>: !<span class="keyword">this</span>.state.liked</div><div class="line">    &#125;)</div><div class="line">  &#125;;</div><div class="line">  </div><div class="line">render = <span class="function">(<span class="params">text=<span class="keyword">this</span>.state.liked? <span class="string">'like'</span> : <span class="string">'don\'t like'</span></span>)=&gt;</span>(</div><div class="line">    &lt;p onClick=&#123;this.handleClick&#125;&gt;</div><div class="line">    you &#123;text&#125; this.click to toggle</div><div class="line">  &lt;/p&gt;</div><div class="line">  );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="八、表单"><a href="#八、表单" class="headerlink" title="八、表单"></a>八、表单</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloMessage</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  state = &#123;</div><div class="line">    <span class="attr">value</span>: <span class="string">'hello'</span></div><div class="line">  &#125;;</div><div class="line">handleChange = <span class="function">(<span class="params">e</span>)=&gt;</span> &#123;</div><div class="line">  <span class="keyword">this</span>.setState(&#123;</div><div class="line">    <span class="attr">value</span>: e.target.value</div><div class="line">  &#125;)</div><div class="line">&#125;;</div><div class="line">render = <span class="function">(<span class="params">value=<span class="keyword">this</span>.state.value</span>)=&gt;</span> (</div><div class="line">  &lt;div&gt;</div><div class="line">    &lt;input type='text' onChange = &#123;this.handleChange&#125; /&gt;</div><div class="line">    &lt;p&gt;&#123;value&#125;&lt;/p&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="九、组件生命周期"><a href="#九、组件生命周期" class="headerlink" title="九、组件生命周期"></a>九、组件生命周期</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloMessage</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  state = &#123;</div><div class="line">    <span class="attr">opacity</span>: <span class="number">1.0</span></div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  componentDidMount = <span class="function"><span class="params">()</span>=&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.timer = setInterval(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</div><div class="line">      <span class="keyword">let</span> opacity = <span class="keyword">this</span>.state.opacity;</div><div class="line">      opacity -= <span class="number">.05</span>;</div><div class="line">       <span class="keyword">if</span> (opacity &lt; <span class="number">0.1</span>) &#123;</div><div class="line">        opacity = <span class="number">1.0</span>;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">this</span>.setState(&#123;</div><div class="line">        <span class="attr">opacity</span>: opacity</div><div class="line">      &#125;);</div><div class="line">    &#125;, <span class="number">100</span>)</div><div class="line">  &#125;;</div><div class="line">  render=<span class="function"><span class="params">()</span>=&gt;</span> (</div><div class="line">    &lt;div style=&#123;&#123; opacity: this.state.opacity&#125;&#125; &gt;</div><div class="line">      Hello &#123;this.props.name&#125;</div><div class="line">      &lt;/div&gt;</div><div class="line">  );</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/* 关于componentWillMount */</span></div><div class="line"></div><div class="line"><span class="comment">// The ES5 way</span></div><div class="line"><span class="keyword">var</span> EmbedModal = React.createClass(&#123;</div><div class="line">  <span class="attr">componentWillMount</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; … &#125;,</div><div class="line">&#125;);</div><div class="line"><span class="comment">// The ES6+ way</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmbedModal</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(props) &#123;</div><div class="line">    <span class="keyword">super</span>(props);</div><div class="line">    <span class="comment">// Operations usually carried out in componentWillMount go here</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserGist</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  state = &#123;</div><div class="line">    <span class="attr">username</span>: <span class="string">''</span>,</div><div class="line">    <span class="attr">lastGistUrl</span>: <span class="string">''</span></div><div class="line">  &#125;;</div><div class="line">  </div><div class="line">  componentDidMount = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">    $.get(<span class="keyword">this</span>.props.source, (result) =&gt; &#123;</div><div class="line">    <span class="keyword">let</span> lastGist = result[<span class="number">0</span>];</div><div class="line">      <span class="keyword">this</span>.setState(&#123;</div><div class="line">        <span class="attr">username</span>: lastGist.owner.login,</div><div class="line">        <span class="attr">lastGistUrl</span>: lastGist.html_url</div><div class="line">      &#125;)</div><div class="line">    &#125;)</div><div class="line">  &#125;;</div><div class="line"></div><div class="line"><span class="comment">/* isMOunt()废弃后的解决方案 当异步加载数据的时候，使用 componentWillUnmount 来取消任何未完成的请求 在组件卸载之前 */</span></div><div class="line"></div><div class="line">componentWillUnmount = <span class="function"><span class="params">()</span> =&gt;</span> &#123;  </div><div class="line">    <span class="keyword">this</span>.serverRequest.abort();  </div><div class="line">  &#125;;</div><div class="line"></div><div class="line">render = <span class="function"><span class="params">()</span>=&gt;</span>(</div><div class="line">  &lt;div&gt;</div><div class="line">    &#123;this.state.username&#125;'s last gist is &lt;a href=&#123;this.state.lastGistUrl&#125;&gt;here&lt;/a&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">);</div><div class="line">&#125;</div><div class="line"></div><div class="line">render(</div><div class="line">  &lt;UserGist source="https://api.github.com/users/octocat/gists" /&gt;,</div><div class="line">  document.body</div><div class="line">)</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="ant" />
          <p class="site-author-name" itemprop="name">ant</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">17</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">Tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ant</span>
</div>


<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  

  

  

  


</body>
</html>
